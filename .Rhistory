arrow = arrow(length = unit(0.25, "cm"))) +
# Aggregated negative relationship annotation
annotate("label", x = 7.8, y = 9.8,
label = "Aggregated (dashed) trend:\nnegative â‡’ Simpson's paradox",
size = 4.2, fill = "#FFF3F0", color = "grey20", label.size = 0.2) +
annotate("curve", x = 7.6, y = 9.4, xend = 6.6, yend = 7.2,
curvature = 0.3, color = "black",
arrow = arrow(length = unit(0.25, "cm"))) +
# ---- Scales, labels, theme ----
scale_color_manual(values = pal) +
labs(
x = "x",
y = "y",
color = "Group"
) +
theme_classic(base_size = 13) +
theme(
legend.position = "inside",
legend.position.inside = c(.8,.9),
legend.title = element_blank(),
axis.title = element_text(face = "bold"),
plot.title = element_text(face = "bold", size = 16),
plot.subtitle = element_text(size = 12, color = "grey30"),
plot.caption = element_text(color = "grey40")
)
p
# Chunk 7
pandat <- tribble(
~u, ~t,~x,~gap,~c,
"A", 1, 1.4,0,2,
"A", 2, 1.7,0,2,
"A", 3, 2.1,0,2,
"B", 1, 2.1,5.24,1.5,
"B", 2, 2.5,5.24,1.5,
"B", 3, 2.7,5.24,1.5,
"C", 1, 1.9,2.4,3.5,
"C", 2, 2.0,2.4,3.5,
"C", 3, 2.3,2.4,3.5,
)
set.seed(13)
pandat |>
mutate(y = 2.7 - 1.59*x + gap + rnorm(9, mean = 0, sd = .25)) |>
mutate(across(c(x,y),
~ round(.x, digits = 1))) |>
select(-gap) -> pandat
# Chunk 8
pandat
# Chunk 9: fig-pandat
#| label: fig-pandat
#| fig-cap: "Relationship between x and y in simulated data"
#| echo: false
#| eval: true
#| warning: false
pandat |>
ggplot(aes(x = x, y = y)) +
geom_point(aes(color = u)) +
geom_smooth(aes(group = u, color = u), method = "lm", se = F) +
geom_text(aes(label = t, group = u, color = u), vjust = 1.5) +
geom_smooth(method = "lm", se = F, color = "black", linetype = "dashed") +
scale_color_manual(values = c("#7fc97f","#beaed4","#fdc086")) +
labs(color = "Group (u)") +
theme(legend.position = "bottom")
# Chunk 10
pooled_plm <- plm::plm(y ~ x,
index = c("u","t"),
model = "pooling",
data = pandat)
summary(pooled_plm)
# Chunk 11
pooled_lm <- lm(y ~ x,
data = pandat)
summary(pooled_lm)
# Chunk 12
screenreg(list(pooled_plm,pooled_lm),
stars = 0.05,
custom.model.names = c("Pooling (plm)",
"Regular OLS"))
# Chunk 13
pandat |>
group_by(u) |>
summarise(avg_y = mean(y),
avg_x = mean(x)) -> pan_ag
# Chunk 14
pan_ag |>
ggplot(aes(x = avg_x, y = avg_y)) +
geom_text(aes(label = u)) +
geom_smooth(method = "lm", se = F)
# Chunk 15
be_ols <- lm(avg_y ~ avg_x,
data = pan_ag)
summary(be_ols)
# Chunk 16
be_plm <- plm::plm(y ~ x,
index = c("u","t"),
model = "between",
data = pandat)
summary(be_plm)
# Chunk 17
screenreg(list(be_ols,be_plm),
stars = 0.05,
custom.model.names = c("OLS with aggregated data",
"Between-effects model (plm)"))
# Chunk 18
pandat |>
group_by(u) |>
mutate(avg_x = mean(x),
avg_y = mean(y)) |>
ungroup() |>
mutate(diff_x = x - avg_x,
diff_y = y - avg_y) -> pandat
# Chunk 19
fe_ols <- lm(diff_y ~ diff_x,
data = pandat)
summary(fe_ols)
# Chunk 20
fe_plm <- plm::plm(y ~ x,
index = c("u","t"),
model = "within",
data = pandat)
summary(fe_plm)
# Chunk 21
fe_dum <- lm(y ~ x + u,
data = pandat)
summary(fe_dum)
# Chunk 22
screenreg(list(fe_ols,fe_plm,fe_dum),
stars = 0.05,
custom.model.names = c("Regular OLS (dem. data)",
"Fixed-effects (plm)",
"Fixed-effects (dummies)"))
# Chunk 23
pandat
# Chunk 24
pandat |>
group_by(u) |>
mutate(avg_c = mean(c)) |>
ungroup() |>
mutate(diff_c = c - avg_c) -> pandat
pandat |>
select(u,t,c,avg_c,diff_c)
# Chunk 25
#| error: true
fe_plm_c <- plm(y ~ c,
index = c("u","t"),
model = "within",
data = pandat)
# Set a seed for reproducibility
set.seed(123)
# Define the number of observations
n_obs <- 100
# Generate the heteroscedastic data
hetero_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 0.5 * x),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
# Plot the data using ggplot2 to visualize the heteroscedasticity
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
labs(
title = "Generated Heteroscedastic Data (Cone Shape)",
x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_minimal()
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F)
labs(
title = "Generated Heteroscedastic Data (Cone Shape)",
x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_minimal()
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F) +
labs(
title = "Generated Heteroscedastic Data (Cone Shape)",
x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
n_obs <- 100
# Generate the heteroscedastic data
hetero_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 0.7 * x),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
# Plot the data using ggplot2 to visualize the heteroscedasticity
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F) +
labs(
title = "Heteroscedastic Data ",
x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
set.seed(123)
# Define the number of observations
n_obs <- 100
# Generate the heteroscedastic data
hetero_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 1.2 * x),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
# Plot the data using ggplot2 to visualize the heteroscedasticity
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F) +
labs(
title = "Heteroscedastic Data ",
x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
# Define the number of observations
n_obs <- 100
# Generate the heteroscedastic data
hetero_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 2 * x),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
# Plot the data using ggplot2 to visualize the heteroscedasticity
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F) +
labs(
title = "Heteroscedastic Data ",
x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
homo_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 1),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
ggplot(homo_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F) +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
# Generate the homoscedastic data
homo_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 0 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 1),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
ggplot(homo_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F) +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
#| layout-ncol: 2
#| fig-cap: "Homo- and heteroscedastic error structures"
# Set a seed for reproducibility
set.seed(123)
# Define the number of observations
n_obs <- 100
# Generate the homoscedastic data
homo_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 1),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
ggplot(homo_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F) +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
# Generate the heteroscedastic data
hetero_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 2 * x),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
# Plot the data using ggplot2 to visualize the heteroscedasticity
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm", se = F) +
labs(
title = "Heteroscedastic Data ",
x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
#| layout-ncol: 2
#| label: fig-homo
#| fig-cap: "Homo- and heteroscedastic error structures"
#| fig-subcap:
#| - "Homoscedastic data"
#| - "Heteroscedastic data"
#| echo: false
#| warning: false
# Set a seed for reproducibility
set.seed(42)
# Define the number of observations
n_obs <- 100
# Generate the homoscedastic data
homo_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 1),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
ggplot(homo_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
# Generate the heteroscedastic data
hetero_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 2 * x),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
# Plot the data using ggplot2 to visualize the heteroscedasticity
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
#| layout-ncol: 2
#| label: fig-homo
#| fig-cap: "Homo- and heteroscedastic error structures"
#| fig-subcap:
#| - "Homoscedastic data"
#| - "Heteroscedastic data"
#| echo: false
#| warning: false
# Set a seed for reproducibility
set.seed(42)
# Define the number of observations
n_obs <- 100
# Generate the homoscedastic data
homo_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 5),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
ggplot(homo_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
# Generate the heteroscedastic data
hetero_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 2 * x),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
# Plot the data using ggplot2 to visualize the heteroscedasticity
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
#| layout-ncol: 2
#| label: fig-homo
#| fig-cap: "Homo- and heteroscedastic error structures"
#| fig-subcap:
#| - "Homoscedastic data"
#| - "Heteroscedastic data"
#| echo: false
#| warning: false
# Set a seed for reproducibility
set.seed(42)
# Define the number of observations
n_obs <- 100
# Generate the homoscedastic data
homo_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 5),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
ggplot(homo_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
# Generate the heteroscedastic data
hetero_data <- tibble(
# 1. Generate an independent variable (e.g., 'x')
x = runif(n_obs, min = 1, max = 10),
# 2. Define the true linear relationship (e.g., y = 5 + 2*x)
true_y = 5 + 2 * x,
# 3. Generate heteroscedastic error term:
#    The standard deviation of the error increases with 'x'.
#    Here, sd is set as 0.5 * x.
error = rnorm(n_obs, mean = 0, sd = 5 * x),
# 4. Calculate the final dependent variable (y)
y = true_y + error
)
# Plot the data using ggplot2 to visualize the heteroscedasticity
ggplot(hetero_data, aes(x = x, y = y)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x = "Independent Variable (x)",
y = "Dependent Variable (y)"
) +
theme_classic()
