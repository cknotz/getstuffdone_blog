library(tidyverse)
tweets <- read.csv("https://zenodo.org/records/7347479/files/FR-R-MIGR-TWIT-2011-2022_meta.csv?download=1", sep = ";")
glimpse(tweets)
tweets |>
slice_head(n = 10) |>
select(data__text)
tweets |>
filter(data__id != "data__id" & data__id!="") -> tweets
tweets |>
mutate(clean_text = str_remove_all(data__text, "@|#|http?://\\S+")) -> tweets
tweets |>
slice_head(n = 10) |>
select(clean_text)
start <- Sys.time()
tweets |>
slice_head(n = 10) |>
select(data__text) |>
llm_translate(data__text,
language = "english") -> translated
end <- Sys.time()
diff <- end-start
diff
translated |>
select(.translation)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention social fraud?",
pred_name = "socialfraud") -> checked
end <- Sys.time()
diff <- end-start
diff
checked |>
select(clean_text,socialfraud)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention Nicolas Sarkozy?",
pred_name = "sarkozy") -> checked
end <- Sys.time()
diff <- end-start
diff
checked
checked |>
select(clean_text,sarkozy)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention Marine Le Pen?",
pred_name = "lepen") -> checked
end <- Sys.time()
diff <- end-start
diff
checked |>
select(clean_text,lepen)
?mall::llm_extract
library(mall)
llm_use("ollama","llama3.1")
library(tidyverse)
tweets <- read.csv("https://zenodo.org/records/7347479/files/FR-R-MIGR-TWIT-2011-2022_meta.csv?download=1", sep = ";")
glimpse(tweets)
tweets |>
slice_head(n = 10) |>
select(data__text)
tweets |>
filter(data__id != "data__id" & data__id!="") -> tweets
tweets |>
mutate(clean_text = str_remove_all(data__text, "@|#|http?://\\S+")) -> tweets
tweets |>
slice_head(n = 10) |>
select(clean_text)
start <- Sys.time()
tweets |>
slice_head(n = 10) |>
select(data__text) |>
llm_translate(data__text,
language = "english") -> translated
library(mall)
llm_use("ollama","llama3.1")
library(tidyverse)
tweets <- read.csv("https://zenodo.org/records/7347479/files/FR-R-MIGR-TWIT-2011-2022_meta.csv?download=1", sep = ";")
glimpse(tweets)
tweets |>
slice_head(n = 10) |>
select(data__text)
tweets |>
filter(data__id != "data__id" & data__id!="") -> tweets
tweets |>
mutate(clean_text = str_remove_all(data__text, "@|#|http?://\\S+")) -> tweets
tweets |>
slice_head(n = 10) |>
select(clean_text)
start <- Sys.time()
tweets |>
slice_head(n = 10) |>
select(data__text) |>
llm_translate(data__text,
language = "english") -> translated
end <- Sys.time()
diff <- end-start
diff
translated |>
select(.translation)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention social fraud?",
pred_name = "socialfraud") -> checked
end <- Sys.time()
diff <- end-start
diff
checked |>
select(clean_text,socialfraud)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention Marine Le Pen?",
pred_name = "lepen") -> checked
end <- Sys.time()
diff <- end-start
diff
checked |>
select(clean_text,lepen)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, politician)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "political party",
pred_name = "party",
additional_prompt = "return NA if the tweet does not explicitly mention a French political party") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, party)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
pred_name = "politician",
additional_prompt = "return NA if the tweet does not explicitly mention a French politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, politician)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician", #,additional_prompt = "return NA if the tweet does not explicitly mention a French politician"
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, politician)
checked |>
select(clean_text,lepen)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
additional_prompt = "return NA if the tweet does not explicitly mention a French politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
rm(extracted)
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
pred_name = "politician") -> extracted
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
additional_prompt = "return NA if the tweet does not explicitly mention a French politician",
pred_name = "politician") -> extracted
extracted |>
select(clean_text, politician)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, politician)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
additional_prompt = "return NA if the tweet does not explicitly mention a French politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, politician)
extracted |>
select(clean_text, politician)
library(mall)
llm_use("ollama","llama3.1",
seed = 42)
library(tidyverse)
tweets <- read.csv("https://zenodo.org/records/7347479/files/FR-R-MIGR-TWIT-2011-2022_meta.csv?download=1", sep = ";")
glimpse(tweets)
tweets |>
slice_head(n = 10) |>
select(data__text)
tweets |>
filter(data__id != "data__id" & data__id!="") -> tweets
tweets |>
mutate(clean_text = str_remove_all(data__text, "@|#|http?://\\S+")) -> tweets
tweets |>
slice_head(n = 10) |>
select(clean_text)
start <- Sys.time()
tweets |>
slice_head(n = 10) |>
select(data__text) |>
llm_translate(data__text,
language = "english") -> translated
end <- Sys.time()
diff <- end-start
diff
translated |>
select(.translation)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention social fraud?",
pred_name = "socialfraud") -> checked
end <- Sys.time()
diff <- end-start
diff
checked |>
select(clean_text,socialfraud)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention Marine Le Pen?",
pred_name = "lepen") -> checked
end <- Sys.time()
diff <- end-start
diff
checked |>
select(clean_text,lepen)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, politician)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
additional_prompt = "return NA if the tweet does not explicitly mention a French politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
library(mall)
llm_use("ollama","llama3.1",
seed = 42)
library(tidyverse)
tweets <- read.csv("https://zenodo.org/records/7347479/files/FR-R-MIGR-TWIT-2011-2022_meta.csv?download=1", sep = ";")
glimpse(tweets)
tweets |>
slice_head(n = 10) |>
select(data__text)
tweets |>
filter(data__id != "data__id" & data__id!="") -> tweets
tweets |>
mutate(clean_text = str_remove_all(data__text, "@|#|http?://\\S+")) -> tweets
tweets |>
slice_head(n = 10) |>
select(clean_text)
start <- Sys.time()
tweets |>
slice_head(n = 10) |>
select(data__text) |>
llm_translate(data__text,
language = "english") -> translated
end <- Sys.time()
diff <- end-start
diff
translated |>
select(.translation)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention social fraud?",
pred_name = "socialfraud") -> checked
end <- Sys.time()
diff <- end-start
diff
checked |>
select(clean_text,socialfraud)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_verify(clean_text, "does this tweet mention Marine Le Pen?",
pred_name = "lepen") -> checked
end <- Sys.time()
diff <- end-start
diff
checked |>
select(clean_text,lepen)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, politician)
start <- Sys.time()
tweets %>%
select(clean_text) %>%
slice_head(n = 10) %>%
llm_extract(clean_text, "French politician",
additional_prompt = "return NA if the tweet does not explicitly mention a French politician",
pred_name = "politician") -> extracted
end <- Sys.time()
diff <- end-start
diff
extracted |>
select(clean_text, politician)
library(mall)
llm_use("ollama","llama3.1")
library(tidyverse)
tweets <- read.csv("https://zenodo.org/records/7347479/files/FR-R-MIGR-TWIT-2011-2022_meta.csv?download=1", sep = ";")
library(tidyverse)
theme_set(theme_classic())
ess7 <- haven::read_dta("/Users/carloknotz/Documents/Work/Stavanger/Teaching/Statistics/bst290_tutorials_site/ess7.dta")
ess7 %>%
select(idno,cntry,essround,isco08,gndr,agea,trstplt) -> ess7
scores <- haven::read_dta("/Users/carloknotz/Documents/R-code/task.dta")
head(scores)
summary(scores$BK)
scores %>%
arrange(-BK) %>%
head()
scores %>%
arrange(BK) %>%
head()
ess7 %>%
mutate(isco08_scores = as.numeric(isco08)) -> ess7
head(ess7)
ess7 %>%
mutate(isco88 = occupar::isco08to88(isco08_scores)) -> ess7
head(ess7)
ess7 %>%
mutate(isco88_2d = as.numeric(substr(as.character(isco88), 1,2))) -> ess7
ess7 %>%
relocate(idno,cntry,essround,isco08,isco88,isco88_2d) %>%
head()
scores %>%
mutate(isco88_2d = as.numeric(occupation)) -> scores
ess7 %>%
left_join(scores, by = "isco88_2d") -> ess7
ess7 %>%
select(idno,isco08,isco88_2d,BK,RTI_alm_isco_77) %>%
head()
ess7 <- labelled::unlabelled(ess7)
ess7 %>%
group_by(gndr) %>%
summarise(avg_BK = mean(BK, na.rm = T)) %>%
drop_na() %>%
ggplot(aes(x = gndr, y = avg_BK)) +
geom_col()
#| classes: preview-image
ess7 %>%
group_by(occupation) %>%
summarise(avg_age = mean(agea, na.rm = T),
avg_BK = mean(BK, na.rm = T)) %>%
drop_na() %>%
ggplot(aes(x = avg_age, y = avg_BK)) +
geom_point() +
geom_text(aes(label = occupation), vjust = 1,
color = "grey",
size = 3) +
geom_smooth(method = "lm", color = "grey",
linetype = "dashed", se = F) +
labs(x = "Average age in occupational group",
y = "Average offshoreability")
ess7 %>%
drop_na(trstplt,BK) %>%
ggplot(aes(x = trstplt, y = BK)) +
geom_count()
#geom_hex(binw
ess7 %>%
drop_na(trstplt,BK) %>%
ggplot(aes(y = trstplt, x = BK)) +
geom_count()
ess7 %>%
drop_na(trstplt,BK) %>%
ggplot(aes(y = trstplt, x = BK)) +
geom_count() +
geom_smooth()
ess7 %>%
drop_na(trstplt,BK) %>%
ggplot(aes(y = trstplt, x = BK)) +
geom_count() +
geom_smooth(method = "lm")
ess7 %>%
drop_na(trstplt,BK) %>%
ggplot(aes(y = trstplt, x = BK)) +
geom_point() +
geom_smooth(method = "lm")
ess7
ess7 %>%
ungroup() +
drop_na(trstplt,BK) %>%
ggplot(aes(y = trstplt, x = BK)) +
geom_point() +
geom_smooth(method = "lm")
ess7 %>%
ungroup() |>
drop_na(trstplt,BK) %>%
ggplot(aes(y = trstplt, x = BK)) +
geom_point() +
geom_smooth(method = "lm")
ess7 %>%
drop_na(trstplt,BK) %>%
ggplot(aes(y = trstplt, x = BK)) +
geom_hex(binwidth = c(1,.75))
ess7
ess7 %>%
drop_na(trstplt,BK) %>%
ggplot(aes(y = as.numeric(trstplt)-1, x = BK)) +
geom_hex(binwidth = c(1,.75))
ess7 %>%
drop_na(trstplt,BK) %>%
ggplot(aes(y = as.numeric(trstplt)-1, x = BK)) +
geom_count()
table(ess7$trstplt)
bst290::visfactor(dataset = ess7, variable = "trstplt")
ess7 %>%
drop_na(trstplt,BK) %>%
mutate(trstplt_num = as.numeric(trstplt)-1)
ggplot(aes(y = trstplt_num, x = BK)) +
geom_count()
ess7 %>%
drop_na(trstplt,BK) %>%
mutate(trstplt_num = as.numeric(trstplt)-1)
ggplot(aes(y = trstplt_num, x = BK)) +
geom_count()
ess7 %>%
drop_na(trstplt,BK) %>%
mutate(trstplt_num = as.numeric(trstplt)-1) %>%
ggplot(aes(y = trstplt_num, x = BK)) +
geom_count()
ess7 %>%
drop_na(trstplt,BK) %>%
mutate(trstplt_num = as.numeric(trstplt)-1) %>%
ggplot(aes(y = trstplt_num, x = BK)) +
geom_hex(binwidth = c(1,.75))
ess7 %>%
drop_na(trstplt,BK) %>%
mutate(trstplt_num = as.numeric(trstplt)-1) %>%
ggplot(aes(y = trstplt_num, x = BK)) +
geom_hex(binwidth = c(.75,1))
parallel::detectCores()
